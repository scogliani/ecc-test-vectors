#include <create_ecc.h>
#include <ecc_pointmul.h>

#include <openssl/err.h>

#include <string.h>

int main(int argc, char** argv)
{
  if (argc != 2)
  {
    return -1;
  }

  EC_GROUP* secp192r1 =
      create_ecc("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF",
                 "FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC",
                 "64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1",
                 "188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012",
                 "07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",
                 "FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831",
                 "01");

  EC_GROUP* secp224r1 =
      create_ecc("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001",
                 "FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE",
                 "B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4",
                 "B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21",
                 "BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",
                 "FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D",
                 "01");

  EC_GROUP* secp256r1 = create_ecc(
      "FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF",
      "FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC",
      "5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B",
      "6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296",
      "4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",
      "FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551",
      "01");

  EC_GROUP* secp384r1 = create_ecc(
      "FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF"
      "0000000000000000FFFFFFFF",
      "FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF"
      "0000000000000000FFFFFFFC",
      "B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D"
      "8A2ED19D2A85C8EDD3EC2AEF",
      "AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25D"
      "BF55296C3A545E3872760AB7",
      "3617DE4A96262C6F5D9E98BF9292DC29F8F41DBD289A147CE9DA3113B5F0B8C00A60B1CE"
      "1D7E819D7A431D7C90EA0E5F",
      "FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB2"
      "48B0A77AECEC196ACCC52973",
      "01");

  EC_GROUP* secp521r1 = create_ecc(
      "01FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"
      "FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF",
      "01FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF"
      "FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC",
      "0051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E15619"
      "3951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00",
      "00C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B"
      "5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66",
      "011839296A789A3BC0045C8A5FB42C7D1BD998F54449579B446817AFBD17273E662C97EE"
      "72995EF42640C550B9013FAD0761353C7086A272C24088BE94769FD16650",
      "01FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA5186"
      "8783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409",
      "01");

  EC_GROUP* frp256v1 = create_ecc(
      "F1FD178C0B3AD58F10126DE8CE42435B3961ADBCABC8CA6DE8FCF353D86E9C03",
      "F1FD178C0B3AD58F10126DE8CE42435B3961ADBCABC8CA6DE8FCF353D86E9C00",
      "EE353FCA5428A9300D4ABA754A44C00FDFEC0C9AE4B1A1803075ED967B7BB73F",
      "B6B3D4C356C139EB31183D4749D423958C27D2DCAF98B70164C97A2DD98F5CFF",
      "6142E0F7C8B204911F9271F0F3ECEF8C2701C307E8E4C9E183115A1554062CFB",
      "F1FD178C0B3AD58F10126DE8CE42435B53DC67E140D2BF941FFDD459C6D655E1",
      "01");

  if (!((getenv("OPENSSL_DEBUG_MEMORY") != NULL) &&
        (0 == strcmp(getenv("OPENSSL_DEBUG_MEMORY"), "off"))))
  {
    CRYPTO_malloc_debug_init();
    CRYPTO_set_mem_debug_options(V_CRYPTO_MDEBUG_ALL);
  }
  else
  {
    CRYPTO_set_mem_debug_functions(0, 0, 0, 0, 0);
  }
  CRYPTO_mem_ctrl(CRYPTO_MEM_CHECK_ENABLE);
  ERR_load_crypto_strings();

  fprintf(stdout, "[%s]\n", argv[1]);
  if (!strncmp("secp192r1", argv[1], 9))
  { 
    ecc_pointmul(secp192r1);
  } else if (!strncmp("secp224r1", argv[1], 9)) {
    ecc_pointmul(secp224r1);
  } else if (!strncmp("secp256r1", argv[1], 9)) {
    ecc_pointmul(secp256r1);
  } else if (!strncmp("secp384r1", argv[1], 9)) {
    ecc_pointmul(secp384r1);
  } else if (!strncmp("secp521r1", argv[1], 9)) {
    ecc_pointmul(secp521r1);
  } else if (!strncmp("frp256v1", argv[1], 8)) {
    ecc_pointmul(frp256v1);
  } 

  EC_GROUP_free(frp256v1);
  EC_GROUP_free(secp521r1);
  EC_GROUP_free(secp384r1);
  EC_GROUP_free(secp256r1);
  EC_GROUP_free(secp224r1);
  EC_GROUP_free(secp192r1);
  CRYPTO_cleanup_all_ex_data();
  ERR_free_strings();
  ERR_remove_thread_state(NULL);
  CRYPTO_mem_leaks_fp(stderr);

  return 0;
}
